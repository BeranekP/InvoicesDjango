{% extends "../base/base.html" %}
{% load i18n %} {% load l10n %} {% load static %}
{% block style %}
<style>
body{
  background: #343a40;
  color: #f8f9fa;
}
.form-control{
background-color: #f1f1f1;
}

</style>
{% endblock %}
    {% block title %}
    Invoice Factory - Nová {{type}}
    {% endblock %} 
{% block content %}

{% include "../base/flash_message.html" %}

    <div class="container mt-3">
      <h2 class="mt-2, pb-5">Nová {{type}}</h2>
      <form action="./" method="POST">
        {% csrf_token %}
        <div class="form-group">
          <label for="recipientInput">Odběratel</label>
          <div class="d-flex flex-row w-100 align-items-center">
            <select
              class="form-control"
              id="recipientInput"
              name="recipient"
              required
            >
              <option value="" disabled selected>Vyberte odběratele</option>
              {% for recipient in recipients %}
              <option value="{{recipient.id}}">
                {{recipient.surname}} {{recipient.name}} - {{recipient.street}}, {{recipient.zipcode}}, {{recipient.town}}
              </option>
              {% endfor %}
            </select>
            <a
              class="btn btn-outline-info ml-1"
              href="../../recipient/create/"
              title="Přidat odběratele"
              >+</a
            >
          </div>
        </div>
        {% localize off %}
        <div class="form-group">
          <label for="invoiceID">ID</label>
          <input
            type="number"
            class="form-control"
            id="invoiceID"
            name="id"
            value="{{ iid }}"
            required
          />
        </div>
        {% endlocalize%}
        <div class="form-group">
          <label for="descriptionTextarea">Popis</label>
          <textarea
            class="form-control"
            id="descriptionTextarea"
            rows="7"
            name="description"
            required
          ></textarea>
        </div>
        <div class="form-group">
          <label for="items">Rozpis položek</label>
          <input
            type="checkbox"
            class="form-check-input ml-2"
            id="items"
            name="hasItems"
          />
          <div id="itemList" class="w-100 mx-auto"></div>
          <div
            id="addRow"
            class="mt-2 mb-2 justify-content-center w-100 d-flex"
          ></div>
        </div>
        <div class="form-group d-flex">
          <div class="mr-2 w-50">
            <label for="amountInput">Částka</label>
            <input
              type="number"
              class="form-control"
              id="amountInput"
              placeholder="1000"
              name="amount"
              step="1"
              value="{{invoice.amount|localize}}"
              required
            />
          </div>
          <div class="form-group ml-2 w-25">
            <label for="currencyInput">Měna</label>
            <select name="currency" id="currencyInput" class="form-control">
            {% for rate in rates %}
              <option value='{{rate}}'>{{rate}}</option>
            {% endfor %}
            </select>
          </div>
          <div class="form-group ml-2 w-50">
            <label for="paymentInput">Způsob platby</label>
            <select name="payment" id="paymentInput" class="form-control">
              <option value="bankovním převodem">bankovním převodem</option>
              <option value="hotově">hotově</option>
            </select>
          </div>
        </div>

        <div class="form-inline mt-3 mb-3 w-100 d-flex justify-content-between">
          
            <label for="createdInput">Vystaveno</label>
            <input
              type="date"
              class="form-control"
              id="createdInput"
              name="created"
              value="{{ default_dates.created|date:'Y-m-d'}}"
              required
            />
         
            <label for="dueInput">Splatnost</label>
            <input
              type="date"
              class="form-control"
              id="dueInput"
              name="due"
              value="{{ default_dates.due|date:'Y-m-d'}}"
              required
            />
          
            <label for="paidInput">Uhrazeno</label>
            <input type="date" class="form-control" id="paidInput" name="paid"
          value="{{invoice.paid|date:"Y-m-d"}}" />
            </div>
      {% if type == "faktura" %}
        <div class="form-group mt-3 mb-3 w-100">
          <label for="advanceInput">Připojit zálohu</label>
          <select
              class="form-control"
              id="advanceInput"
              name="advance"
            >
              <option value="" disabled selected>Vyberte zálohu</option>
              {% for advance in advances %}
              <option value="{{advance.id}}">
                {% localize off %}{{advance.iid}}{% endlocalize %}, {{advance.recipient.name}}
              </option>
              {% endfor %}
            </select>
          <div>
      {% endif %}

        <div
          class="form-group d-flex w-100 align-items-center justify-content-center"
        >
          <a href="{{ref}}" class="btn btn-outline-light mr-5 mt-sm-1 mt-md-5 w-sm-50 w-md-25 btn-lg"
            >Zpět</a
          >
          <input
            class="btn btn-outline-success mt-sm-1 mt-md-5 w-md-25 w-sm-50 btn-lg"
            type="submit"
            value="Vystavit"
          />
        </div>
      </form>
    </div>
    {% endblock  %}
    {% block scripts %}
    <script src="{% static 'js/addInvoice.js'%}"></script>
    <script>
      date1 = document.getElementById('createdInput');
      date2 = document.getElementById('dueInput');

      date1.addEventListener('input',(e)=>{
        d = new Date(e.target.value);
        delta = new Date();
        delta.setDate(d.getDate() + 14);
        date2.value = delta.toISOString().substring(0, 10);
      })
      
    </script>
    {% endblock  %}

