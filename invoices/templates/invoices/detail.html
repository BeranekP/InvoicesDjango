{% extends "../base/base.html" %}
{% load i18n %} {% load l10n %} {% load static %}{% load filename %}{% load zipcode %} {% load multiply %}{% load divide %}{% load subtract %}
    {% block display %}
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    {% endblock %}

    
    {% block title %}
      {% localize off %}{{type}} č. {{invoice.iid}} {% endlocalize %}
    {% endblock %}
    
    {% block content %}
    {% localize off %}
    <div class="container px-0 mx-auto">
    <nav
        class="navbar navbar-expand-lg navbar-dark bg-dark justify-content-between fixed-top px-5 py-3 my-0 d-print-none"
      >
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item d-none d-lg-block d-print-none">
            <a href="{{ref}}" class="nav-link">
              Zpět 
            </a> 
            </li>
            <li class="nav-item">
              <a class="nav-link {% ifequal type 'Přehled faktur' %} active {% endifequal %} font-weight-bold" href="/invoices"
                >Faktury</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link {% ifequal type 'Přehled záloh' %} active {% endifequal %} font-weight-bold" href="/advance"
                >Zálohy</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link font-weight-bold" href="/recipient"
                >Odběratelé</a
              >
            </li>
            <li class="nav-item dropdown font-weight-bold">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Nový
              </a>
              <div class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="/invoices/create">Faktura</a>
                <a class="dropdown-item" href="/advance/create">Záloha</a>
                <a class="dropdown-item" href="/recipient/create">Odběratel</a>
              </div>
            </li>
            <li class="nav-item dropdown font-weight-bold">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Fomuláře
              </a>
              <div class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#" onclick=printBlankPage(0,"invoice")> 
                    <img src="{% static 'ico/baseline_picture_as_pdf_black_18dp.png' %}" alt=""> Faktura
                </a> 
                <a class="dropdown-item" href="#" onclick=printBlankPage(0,"advance")> 
                     <img src="{% static 'ico/baseline_picture_as_pdf_black_18dp.png' %}" alt=""> Záloha
                </a> 
              </div>
            </li>
            <li class="nav-item font-weight-bold">
              <a
                class="nav-link"
                href="../../edit/{{invoice.id}}"
                >Upravit</a
              >
            </li>
            <li class="nav-item dropdown font-weight-bold">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Tisk
              </a>
              <div class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#" onclick='printPage(0, "{{type}}")'>PDF </a>
                <a class="dropdown-item" href="#" onclick='printPage(1, "{{type}}")'>PDF s podpisem</a>
              </div>
            </li>
          </ul>
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Nastavení
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item disabled" href="#">{{user.name}}</a>
                <a class="dropdown-item disabled text-info" href="#">{{user.email}}</a>
                <div class="dropdown-divider"></div>
                <a class=" mx-2 dropdown-item" href="/users/edit/{{user.id}}">Profil</a>
                <div class="mx-2 dropdown-item custom-control custom-checkbox">
                <form action="../../../mailcopy/" method='POST' id="mailcopy-form">{% csrf_token %}
                  <input
                  type="checkbox"
                  class="custom-control-input align-self-end "
                  id="mailcopy"
                  name="mailcopy"
                  {% if user.mailcopy %}
                  value=true
                  checked
                  {% else %}
                  value=false
                  {% endif %}
                  />
                  <label for="mailcopy" class="custom-control-label align-self-start"
                  >Faktury e-mailem <img src="{% static 'ico/baseline_attach_email_black_18dp.png' %}" alt=""></label
                  >
                </form>
                </div>
                
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../logout">Odhlásit se</a>
            </li>
          </ul>
        </div>
      </nav>
    <div>
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} text-center w-50 mx-auto mt-5 fixed-top alert-dismissible fade show" role="alert">
            <p>{{ message }}</p>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      </div>
      {% endfor %}
    </div>
      <div class="jumbotron w-100 mb-0 pb-5 overflow-hidden">
        <div class="container w-100 pt-5">
          <h2 class="display-6">{{type}} č. {{invoice.iid}}</h2>
          <hr class="my-4 w-100 mx-0" />
          <div class="row">
            <div class="col-2 d-flex justify-content-start">
              {% load static %}
              <img
                src="{% static user.logo.name|filename %}"
                alt=""
                style="max-width: 100%;"
              />
            </div>
            <div
              class="col-sm-10 col-lg-4 my-1"
            >
              <h5 class="text-center">Dodavatel:</h5>
              <p class="lead text-center">
                {{user.name}} <br />
                {{user.street}} <br />
                {{user.zipcode|zipcode}} {{user.town}}<br />
                {% if user.ic %}
                <br />
                IČ: {{user.ic}} <br />
                {% endif %} {% if user.dic %} DIČ: {{user.dic}}<br />
                {% endif %}
                <a href="mailto:{{user.email}}">{{user.email}}</a>
                {% if user.web %}
                <a href="{{user.web}}">{{user.web}}</a>
                {% endif %}
              </p>
            </div>

            <div class="col-sm-12 col-lg-6">
              <h5 class="text-center">Odběratel:</h5>
              <p class="lead text-center">
                {{invoice.recipient.name}} {{invoice.recipient.surname}}<br />
                {{invoice.recipient.street}} <br />
                {{invoice.recipient.zipcode|zipcode}} {{invoice.recipient.town}}<br />
                {% ifnotequal invoice.recipient.state 'Česká republika'%}
                {{invoice.recipient.state}}<br />
                {% endifnotequal %}
                {% if invoice.recipient.ic %}
                <br />
                IČ: {{invoice.recipient.ic}} <br />
                {% endif %} {% if invoice.recipient.dic %} DIČ:
                {{invoice.recipient.dic}} {% endif %}
              </p>
            </div>
          </div>
          <hr class="my-4 w-100" />
        </div>

        <div id="payment" class="row mx-auto">
          <div
            class="col-lg-6"
          >
            <h5>Bankovní spojení:</h5>
            <div class="row">
              <div class="col-5 col-lg-6">
                Číslo účtu: <br />
                {% ifnotequal invoice.currency 'CZK' %}IBAN: <br />{% endifnotequal %}
                Konstatní symbol: <br />
                Variabilní symbol: <br />
              </div>

              <div class="col-7 px-0 col-lg-6">
                <strong>{{user.bank}} </strong><br />
                {% ifnotequal invoice.currency 'CZK' %}<strong>{{iban}}</strong> <br />{% endifnotequal %}
                0308 <br />
                <strong>{{invoice.iid}}</strong>
              </div>
            </div>
          </div>
          <div
            class="col-lg-6"
          >
            <br />
            <div class="row">
              <div class="col-6">
                Vystaveno:<br />
                Splatnost:<br />
                Způsob platby:<br />
              </div>
              <div class="col-6">
                {{invoice.date|date:"d. m. Y"}} <br />
                {{invoice.datedue|date:"d. m. Y"}} <br />
                {{invoice.payment}}
              </div>
            </div>
          </div>
        </div>
        {% endlocalize %}

        <div class="container w-100">
          <hr class="my-4" />
          <h5>Popis dodávky:</h5>
          <p>
            {{ invoice.description|linebreaksbr }}
          </p>
          {% if items %}
          <hr class="my-4 w-100" />
          <h5>Rozpis položek:</h5>
          <table class="table table-sm table-bordered w-100">
            <thead>
              <tr>
                <th
                  style="
                    font-weight: 500;
                    font-style: italic;
                    text-align: center;
                  "
                >
                  Položka
                </th>
                <th
                  style="
                    font-weight: 500;
                    font-style: italic;
                    text-align: center;
                  "
                >
                  Počet [ks]
                </th>
                <th
                  style="
                    font-weight: 500;
                    font-style: italic;
                    text-align: center;
                  "
                >
                  Cena [{% ifequal invoice.currency 'CZK' %}Kč{% else %}
                  {{invoice.currency}}
                  {% endifequal %}/ks]
                </th>
                <th
                  style="
                    font-weight: 500;
                    font-style: italic;
                    text-align: center;
                  "
                >
                  Celkem [{% ifequal invoice.currency 'CZK' %}Kč{% else %}
                  {{invoice.currency}}
                  {% endifequal %}]
                </th>
              </tr>
            </thead>
            <tbody>
              {% for item in items %}
              <tr>
                <td>{{item.item_name}}</td>
                <td style="text-align: center;">{{item.num_items}}</td>
                <td style="text-align: right;">{{item.price_item}}</td>
                <td style="text-align: right;">{{item.price}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% endif %}
        </div>

        <div class="container w-100">
          <hr class="my-4" />

          <div class="row">
            <div class="col-lg-9 d-flex align-items-center text-center">
              <h2 class="mt-5">
                Celkem k úhradě:
                <span>
                <span class="ml-lg-3 px-2 border border-dark d-sm-flex d-md-inline"
                  >{{invoice.amount|floatformat:2}} 
                  {% ifequal invoice.currency 'CZK' %}
                  Kč
                  {% else %}
                  {{invoice.currency}}</span> 
                  <div class='h6 mt-3 ml-5'>({{ invoice.amount |multiply:invoice.exchange_rate.rate|divide:invoice.exchange_rate.amount|floatformat:2 }} Kč; kurz ČNB k {{invoice.exchange_rate.date}}: {{invoice.exchange_rate.rate|floatformat:3}} Kč/{{invoice.exchange_rate.amount}} {{invoice.currency}})</div>
                  {% endifequal %}
                  </span>
                  
              </h2>
            </div>
            <div class="col-lg-3 d-flex justify-content-center align-items-center">
              {% if invoice.payment == 'bankovním převodem' %} 
                             
                  {{svg}}
                
              {% endif %}
            </div>
             {% if advance %}
              <div class='row'>
                <div class="d-flex align-items-center">
                  <h5 class= 'ml-lg-3 px-2'>Již uhrazeno {{advance.amount|floatformat:2}} Kč. Zbývá uhradit <span class='border border-dark px-2'><strong>{{invoice.amount|subtract:advance.amount|floatformat:2}} Kč</strong>.</span></h5>
                </div>
              </div>
              {% endif %}
          </div>
        </div>

        <div class="w-100 d-flex mt-5">
          <span class="align-self-end d-none d-print-inline">
            <em> Nejsem plátce DPH.</em></span
          >
          <div
            class="w-50 text-center ml-auto mr-5 d-none d-print-block"
            id="stamp"
          >
            <img src={% static user.sign.name|filename %} alt="" class="w-50 pt-3
            mt-5 d-print-none" id="signature">
            <p
              class="w-50 pt-3 mt-5"
              style="border-top: 2px dotted rgba(0, 0, 0, 0.2);"
            >
              Razítko a podpis dodavatele
            </p>
          </div>
          
        
        
          <div id="footer" class="d-none d-print-block">
            <p>
              <em>Podnikatel je zapsán v živnostenském rejstříku MÚ Sušice.</em>
            </p>
          </div>
        </div>
      </div>
      
    </div>
      
    {% endblock  %}
    {% block scripts %}
    <script>
      function printPage(val,type){
        sign = document.getElementById('sign')
        id = {{invoice.pk}}
        window.open('/invoices/print/'+ id + '/?sign='+ val + '&asset=' + type)
      }
      function printBlankPage(val, type){
        window.open('/print/?sign='+ val + '&asset='+ type)
      }
    </script>
    <script src="{% static 'js/mailCopy.js' %}"></script>
    {% endblock  %}
